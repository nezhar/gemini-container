services:
  gemini-proxy:
    image: nezhar/gemini-proxy:${GEMINI_CONTAINER_VERSION:-latest}
    ports:
      - "${PROXY_PORT:-8080}:8080"
    volumes:
      - gemini_logs:/proxy/logs
      - gemini_certs:/proxy/certs
    networks:
      - gemini-network

  gemini-datasette:
    image: nezhar/gemini-datasette:${GEMINI_CONTAINER_VERSION:-latest}
    ports:
      - "${DATASETTE_PORT:-8001}:8001"
    volumes:
      - gemini_logs:/data:ro
    networks:
      - gemini-network
    depends_on:
      - gemini-proxy

  gemini-cli:
    image: nezhar/gemini-container:${GEMINI_CONTAINER_VERSION:-latest}
    environment:
      - HTTP_PROXY=http://gemini-proxy:8080
      - HTTPS_PROXY=http://gemini-proxy:8080
      - CURL_CA_BUNDLE=/mitmproxy/mitmproxy-ca-cert.pem
      - NODE_EXTRA_CA_CERTS=/mitmproxy/mitmproxy-ca-cert.pem
    volumes:
      - ${WORKSPACE_DIR:-.}:/workspace
      - ${GEMINI_CONFIG_DIR:-~/.config/gemini-container}:/gemini
      - gemini_certs:/mitmproxy:ro
    working_dir: /workspace
    networks:
      - gemini-network
    depends_on:
      - gemini-proxy

volumes:
  gemini_logs:
  gemini_certs:

networks:
  gemini-network:
    driver: bridge
